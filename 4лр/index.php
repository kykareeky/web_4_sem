<?php
// Лабораторная работа № А-4: Пользовательские функции. Вывод таблиц.

// --- Инициализация данных ---
// Задаем количество колонок для таблиц (может быть 0, 1, 2, 3 и т.д.)
$numberOfColumns = 3;

// Массив структур таблиц (не менее 10 элементов)
$tableStructures = [
    "Имя*возраст*Город#АФанасий*25*Урюпинск#Изольда*30*Ростов",
    "Товар*Цена*Склад#Яблоко*1.2*100#Банан*0.8*50#Ананас*2.5*0",
    "Название*Автор*Дата издания#Гарри поттер и узник Азкабана*Дж. К. Роулинг*1995",
    "A*B*C#1*2*3#4*5*6#7*8*9",
    "Страна*Столица*Население#Франция*Paris*67M#Россия*Москва*146M",
    "Автомобиль*Модель*Год#Toyota*Camry*2021#Honda*Civic*2022",
    "Язык*Уровень*Уверенность#Русский*Носитель*100%#Английский*Продвинутый*78%",
    "Фрукт*Цвет*Вкус#Яблоко*Красное*Сладкое#Лимон*Желтый*Кислый",
    "Месяц*День*Сезон#Январь*31*Зима#Июнь*30*Лето",
    "Работник*Подразделение*Зарплата#Изольда*IT*50000#Афанасий*HR*40000#Герасим*IT*55000"
];

// --- Функция для получения HTML-кода одной строки таблицы (из листинга А-4.1) ---
function getTR($data, $numCols) {
    $arr = explode('*', $data); // Разбиваем строку на ячейки
    $ret = '<tr>';
    
    // Добавляем ячейки с данными
    for ($i = 0; $i < $numCols; $i++) {
        if (isset($arr[$i]) && trim($arr[$i]) !== '') {
            $ret .= '<td>' . $arr[$i] . '</td>';
        } else {
            $ret .= '<td>&nbsp;</td>'; // Пустая ячейка, если данных нет
        }
    }
    
    return $ret . '</tr>';
}

// --- Функция для вывода целой таблицы (адаптированная из листинга А-4.2) ---
function outTable($structure, $tableNumber, $numCols) {
    echo "<h2>Таблица №$tableNumber</h2>";
    
    // Проверка на нулевое количество колонок
    if ($numCols <= 0) {
        echo "<p>Неправильное число колонок</p>";
        return;
    }
    
    // Разбиваем структуру на строки
    $strings = explode('#', $structure);
    
    // Проверка: есть ли вообще строки в структуре
    if (count($strings) == 0 || (count($strings) == 1 && trim($strings[0]) == '')) {
        echo "<p>В таблице нет строк</p>";
        return;
    }
    
    $datas = ''; // HTML-код всех строк
    $hasValidRow = false;
    
    // Обрабатываем каждую строку
    for ($i = 0; $i < count($strings); $i++) {
        $rowData = trim($strings[$i]);
        
        // Проверка: если строка не пустая (есть ячейки)
        if (!empty($rowData)) {
            $datas .= getTR($rowData, $numCols);
            $hasValidRow = true;
        }
    }
    
    // Проверка: есть ли строки с ячейками
    if (!$hasValidRow) {
        echo "<p>В таблице нет строк с ячейками</p>";
        return;
    }
    
    // Вывод таблицы, если все проверки пройдены
    echo '<table border="1" cellpadding="5" cellspacing="0">';
    echo $datas;
    echo '</table>';
}

// --- Основная программа: вывод всех таблиц ---
echo '<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Лабораторная работа № А-4</title>
    <link rel="stylesheet" href="style.css">  <!-- ЭТА СТРОКА -->
</head>
<body>
    <h1>Лабораторная работа № А-4</h1>';

// Выводим все таблицы из массива
for ($i = 0; $i < count($tableStructures); $i++) {
    outTable($tableStructures[$i], $i + 1, $numberOfColumns);
}

// --- КОНТРОЛЬНЫЕ ВОПРОСЫ ---
echo '
    <hr>
    <h2>Контрольные вопросы</h2>
    <ol>
        <li><strong>Что такое пользовательская функция?</strong> — Это именованный блок кода, который можно многократно вызывать из разных мест программы для выполнения определенной задачи.</li>
        <li><strong>Как функция возвращает значение?</strong> — С помощью оператора <code>return</code>. После выполнения <code>return</code> функция прекращает работу и передает указанное значение в место вызова.</li>
        <li><strong>Можно ли вызвать из функции другую функцию?</strong> — Да, это называется вложенным вызовом. В нашей работе <code>outTable()</code> вызывает <code>getTR()</code>.</li>
        <li><strong>Можно ли вызвать из функции эту же функцию?</strong> — Да, это называется рекурсией. Функция может вызывать саму себя.</li>
        <li><strong>Продолжит ли функция свою работу после выполнения инструкции return?</strong> — Нет, <code>return</code> немедленно завершает выполнение функции.</li>
        <li><strong>Сколько раз инструкция return может быть использована в теле функции?</strong> — Неограниченное количество раз, но выполнится только первый встреченный <code>return</code>.</li>
        <li><strong>Сколько аргументов может быть передано функции?</strong> — В PHP нет строгого ограничения, но рекомендуется не более 5-7 для читаемости кода.</li>
        <li><strong>Что такое аргументы "по умолчанию"?</strong> — Это аргументы, которым в объявлении функции присвоено значение. Если при вызове их не указать, используется значение по умолчанию.</li>
        <li><strong>Может ли функция вообще не иметь аргументов?</strong> — Да, например: <code>function test() { ... }</code>.</li>
        <li><strong>Должны ли совпадать имена переменных-аргументов при объявлении и при вызове функции?</strong> — Нет, важна только позиция аргументов, а не имена переменных.</li>
        <li><strong>Если в теле функции объявлена переменная $P – изменится ли эта переменная с таким же именем в основной программе?</strong> — Нет, если она не объявлена как глобальная. Внутри функции действует локальная область видимости.</li>
        <li><strong>В каких случаях имеет смысл использовать пользовательские функции?</strong> — Когда код повторяется (устранение дублирования), для улучшения читаемости и структурирования программы.</li>
        <li><strong>Может ли функция выводить HTML-код?</strong> — Да, с помощью <code>echo</code> или <code>print</code> внутри функции.</li>
        <li><strong>Может ли функция вызываться непосредственно в операторе echo?</strong> — Да, если функция возвращает значение (использует <code>return</code>).</li>
        <li><strong>Может ли функция одновременно выводить текст в HTML-код браузера и возвращать значение?</strong> — Да, она может и выводить (<code>echo</code>), и возвращать (<code>return</code>). Сначала выполнится вывод, затем возврат.</li>
        <li><strong>В каком порядке формируется HTML-код, если функция не только вызывается непосредственно из оператора echo, но и выводит что-либо внутри себя?</strong> — Сначала выполняется то, что внутри функции (ее вывод), затем возвращаемое значение подставляется в место вызова.</li>
    </ol>
</body>
</html>';
?>